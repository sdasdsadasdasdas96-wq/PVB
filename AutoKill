--// Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local task = task

--// Player & Remotes
local player = Players.LocalPlayer
local UseItemRemote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("UseItem")

-- Wait for character
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

--// Configuration
local IGNORED_NAMES = {
    ["Hotspotini Burrito"] = true,
    ["Rhino Toasterino"] = true,
    ["Ospedale"] = true,
    ["Chef Crabacadabra"] = true,
    ["Dragon Cannelloni"] = true,
    ["Wardenelli Brickatoni"] = true,
    ["Cerberinno Hotdoggino"] = true
    ["Snailini Discozini"] = true
    ["Elefante Formaggio"] = true
    ["Strawberry Camaleonte"] = true

}

local VALID_MUTATIONS = {
    ["Neon"] = true,
    ["Rainbow"] = true,
    ["UpsideDown"] = true,
    ["Galactic"] = true,
    ["Underworld"] = true,
    ["Frozen"] = true,
    ["Magma"] = true,
    ["Ruby"] = true
}

--// Helper: get Frost Grenade tool dynamically
local function getGrenadeTool()
    for _, tool in pairs(character:GetChildren()) do
        if tool:IsA("Tool") and tool.Name:match("^%[x%d+%] Frost Grenade$") then
            return tool
        end
    end
    local backpack = player:WaitForChild("Backpack")
    for _, tool in pairs(backpack:GetChildren()) do
        if tool:IsA("Tool") and tool.Name:match("^%[x%d+%] Frost Grenade$") then
            return tool
        end
    end
    return nil
end

--// Equip grenade
local function equipGrenade()
    local tool = getGrenadeTool()
    if tool and tool.Parent ~= character then
        humanoid:EquipTool(tool)
        task.wait(0.1)
    end
    return getGrenadeTool()
end

--// Filtering logic for Brainrots
local function isValidBrainrot(b)
    if not b:IsA("Model") or not b:GetAttribute("Brainrot") then
        return false
    end

    local name = b:GetAttribute("Brainrot")
    local rarity = b:GetAttribute("Rarity")
    local mutation = b:GetAttribute("Mutation")
    local maxHealth = b:GetAttribute("MaxHealth") or 0

    -- Ignore by name
    if IGNORED_NAMES[name] then
        return false
    end

    -- Must have valid mutation
    if not VALID_MUTATIONS[mutation] then
        return false
    end

    -- Secret rarity rule
    if rarity == "Secret" then
        return maxHealth > 12500000
    end

    -- Normal rule
    return maxHealth > 5000000
end

--// Gather valid targets
local function getTargetBrainrots()
    local folder = Workspace:WaitForChild("ScriptedMap"):WaitForChild("Brainrots")
    local valid = {}
    for _, b in pairs(folder:GetChildren()) do
        if b.PrimaryPart and isValidBrainrot(b) then
            table.insert(valid, b)
        end
    end
    return valid
end

--// Throw grenade
local function throwGrenade(brainrot)
    local tool = equipGrenade()
    if not tool then return false end

    local pos = brainrot.PrimaryPart.Position
    local args = {
        {
            Toggle = true,
            Tool = tool,
            Time = 0.0,
            Pos = vector.create(pos.X, pos.Y, pos.Z)
        }
    }
    UseItemRemote:FireServer(unpack(args))
    return true
end

--// Main loop
task.spawn(function()
    while true do
        local brainrots = getTargetBrainrots()
        for _, b in pairs(brainrots) do
            if b and b.Parent and getGrenadeTool() then
                throwGrenade(b)
                task.wait(0.05)
            end
        end
        task.wait(0.25)
    end
end)
